set interfaces {{ lo_interface.key }} unit {{ lo_interface.value.unit }} family inet address {{ lo_interface.value.address }}

{% for bgp_group in bgp_groups %}
 set security authentication-key-chains key-chain {{ bgp_group.key_chain_name }} key 1 secret {{ bgp_group.key_chain_secret }}
 set security authentication-key-chains key-chain {{ bgp_group.key_chain_name }} key 1 start-time now
 set security authentication-key-chains key-chain {{ bgp_group.key_chain_name }} key 1 algorithm md5
 set protocols bgp group {{ bgp_group.name }} type external
 set protocols bgp group {{ bgp_group.name }} multipath multiple-as
 set protocols bgp group {{ bgp_group.name }} local-as {{ bgp_group.local_as_number }}
 set protocols bgp group {{ bgp_group.name }} local-address {{ lo_interfaces[bgp_group.local_lo].address }}
 set protocols bgp group {{ bgp_group.name }} family evpn signaling
 set protocols bgp group {{ bgp_group.name }} bfd-liveness-detection minimum-interval {{ bgp_group.bfd_minimum_interval }}
 set protocols bgp group {{ bgp_group.name }} bfd-liveness-detection multiplier {{ bgp_group.multiplier }}
 set protocols bgp group {{ bgp_group.name }} bfd-liveness-detection authentication key-chain {{ bgp_group.key_chain_name }}
 set protocols bgp group {{ bgp_group.name }} bfd-liveness-detection authentication algorithm keyed-md5
 {% for neighbor in bgp_group.neighbors %}
  set protocols bgp group {{ bgp_group.name }} neighbor {{ neighbor.peer }} peer-as {{ neighbor.asn }} multiop
 {% endfor %}
{% endfor %}